#!/bin/bash
# Code review —á–µ—Ä–µ–∑ Claude API
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./tools/review.sh api/main.py

set -e

if [ -z "$1" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: —É–∫–∞–∂–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è review"
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <—Ñ–∞–π–ª.py>"
    exit 1
fi

FILE="$1"

if [ ! -f "$FILE" ]; then
    echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $FILE"
    exit 1
fi

echo "üîç Code Review: $FILE"
echo ""

./tools/claude.py "–ü—Ä–æ–≤–µ–¥–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ code review —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞.

**–ü—Ä–æ–≤–µ—Ä—å:**

1. üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - SQL injection, XSS
   - –°–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

2. ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - Async/await –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
   - N+1 queries
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–¥–µ –Ω—É–∂–Ω–æ
   - Memory leaks

3. üìñ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**
   - –ù–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–π
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≥–¥–µ –Ω—É–∂–Ω–æ
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
   - PEP 8 —Å—Ç–∏–ª—å

4. üß™ **–ö–∞—á–µ—Å—Ç–≤–æ**
   - Type hints
   - Docstrings
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - Edge cases

5. üéØ **Best Practices**
   - SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
   - DRY (Don't Repeat Yourself)
   - FastAPI best practices
   - Python best practices

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
- –ù–∞—á–Ω–∏ —Å –æ–±—â–µ–π –æ—Ü–µ–Ω–∫–∏ (1-10)
- –ü–µ—Ä–µ—á–∏—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã –¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–¥–∞
- –ó–∞–∫–æ–Ω—á–∏ —Å–ø–∏—Å–∫–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π

–ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º!" -f "$FILE" --max-tokens 8192
